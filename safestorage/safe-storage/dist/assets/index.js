var se=Object.defineProperty,le=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var q=(e,t,a)=>t in e?se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,j=(e,t)=>{for(var a in t||(t={}))ce.call(t,a)&&q(e,a,t[a]);if(A)for(var a of A(t))de.call(t,a)&&q(e,a,t[a]);return e},H=(e,t)=>le(e,re(t));import{C as ue,a as p,f as fe}from"./vendor.js";const me=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function a(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=a(n);fetch(n.href,i)}};me();let N,R=[];function O(){let e=location.hash.substring(1);if(!e.startsWith("/")){location.hash="/",N="/";return}e!==N&&(N=e,R.forEach(t=>t(e)))}function E(){return N}function pe(e){location.hash=e}function he(e){R.push(e)}setTimeout(O,10);setInterval(O,100);let $,Q=[];function V(){return $}function ye(e){Q.push(e)}async function Z(){return new Promise((e,t)=>{fetch("/uInfo",{cache:"default",keepalive:!1}).then(a=>a.json()).then(a=>{const o=Object.assign({admin:!1,limit:-1,name:"User",prefix:"/",dir_size:0},a);$!==o&&($=o,Q.forEach(n=>setTimeout(n(o))),e($))}).catch(t)})}Z().then(void 0);setInterval(Z,10500);const ge=/href="([\/a-zA-Zа-яА-Я.\d_()\s\-\[\]]*)" class="([a-zA-Z]*)">([\/a-zA-Zа-яА-Я.\d_()\s\-\[\]]*)<\/a>, [a-zA-Z_]*, ?(([\d]*) bytes,)? last modified ([\d-\s:]*[\d])/gm,be=/<a href="([/a-zA-Z\d]*)" class="dir">..<\/a>/gm;async function I(e){for(;!V();)await new Promise(a=>setTimeout(a,3));let t=[];try{const o=await(await fetch(`${location.origin}/storage${V().prefix}${e}`)).text();t.push({ByteSize:0,FileName:"z8yr3n2z8yr3n223zn7t32tz732n23tn72zt23zn7t32tz732n23tn72zt",LastEdited:new Date,Type:"dir",URL:o.matchAll(be).next().value[1]});let n;for(;(n=ge.exec(o))!=null;)t.push({URL:n[1],Type:n[2],ByteSize:Number(n[5])||-1,FileName:n[3],LastEdited:new Date(n[6])})}catch{}return t}const T=document.querySelector(".fileEdit"),F={content:T.querySelector(".content"),cancel:T.querySelector(".cancel__button"),save:T.querySelector(".save__button"),name:T.querySelector(".file__name")};let D=ue(F.content,{lineNumbers:!0,lineWrapping:!0,scrollbarStyle:"native",inputStyle:"contenteditable",autofocus:!0,theme:"mdn-like",showCursorWhenSelecting:!0,addModeClass:!0});function S(e=!0){T.style.display=e?"block":"none"}S(!1);F.cancel.addEventListener("click",()=>{S(!1)});let W="";F.save.addEventListener("click",()=>{S(!1);const e=new FormData;e.set("furl",W),e.set("content",D.getValue()),p.patch("/acts/edit",e).then(void 0)});async function K(e,t){F.name.innerText=`\u0424\u0430\u0439\u043B: ${e}`,W=e;const a=(await p.get(t,{transformResponse:o=>o.toString()})).data;D.setValue(a),D.refresh(),S()}const d=document.getElementById("ctxMenu");function u(e=!1){if(e){d.style.opacity="1",setTimeout(()=>d.style.display="block",160);return}d.style.opacity="0",setTimeout(()=>d.style.display="none",160)}u();let h={event:void 0,exp:"",fileName:"",isFile:!1,url:""};const k={download:d.querySelector(".download__file"),remove:d.getElementsByClassName("remove__file")[0],move:d.querySelector(".move__file"),rename:d.getElementsByClassName("rename__file")[0],edit:d.getElementsByClassName("edit__file")[0]};k.download.addEventListener("click",()=>{p.get(h.url,{responseType:"blob"}).then(e=>{fe(e.data,h.fileName)})});k.remove.addEventListener("click",()=>{const e=E(),t=new FormData;t.set("file",`${e}/${h.fileName}`),p.delete("/acts",{data:t}).then(()=>{u(),z(1e3)}).catch(u)});k.move.addEventListener("click",()=>{const e=E();let t=prompt("New file's path",`${e}/${h.fileName}`.replaceAll("//","/"));if(t===null||t.length<=0)return;const a=new FormData;a.set("fn",`${t}`),a.set("fo",`${e}/${h.fileName}`),p.post("/acts/rename",a).then(()=>{u(),z(1001)}).catch(u)});k.rename.addEventListener("click",()=>{let e=prompt("New file's name",h.fileName);if(e===null||e.length<=0)return;const t=new FormData,a=E();t.set("fn",`${a}/${e}`),t.set("fo",`${a}/${h.fileName}`),p.post("/acts/rename",t).then(()=>{u(),z(1001)}).catch(u)});k.edit.addEventListener("click",()=>{K(h.fileName,h.url).then(void 0),u()});window.addEventListener("click",()=>u());document.body.querySelector(".right-s").addEventListener("contextmenu",e=>{u(),e.preventDefault()});d.addEventListener("contextmenu",e=>e.stopPropagation());d.addEventListener("click",e=>e.stopPropagation());async function J(e,t,a,o,n){k.edit.style.display=e?"initial":"none",h={isFile:e,url:t,fileName:a,exp:o,event:n},n.stopImmediatePropagation(),u(!0),d.style.left=n.x.toString()+"px",d.style.top=n.y.toString()+"px",n.preventDefault()}const v=document.querySelector(".mediaView");let w;function _(e=!0){v.style.display=e?"block":"none"}_(!1);let M,U=!1;function ve(e,t){M=e,t.preventDefault();let a;for(;(a=v.firstChild)!==null;)v.removeChild(a);switch(_(),U=!0,e.Exp){case"png":case"gif":case"jpeg":case"svg":case"webp":case"jpg":{v.innerHTML=`<img src="${M.URL}" alt="\u0444\u0430\u0439\u043B ${e.FileName}"><br/><span>ESCAPE - close</span>`;break}case"mpeg":case"ogg":case"webm":case"mp4":{w=document.createElement("video"),w.src=M.URL,w.preload="auto";try{w.srcObject=new MediaStream}catch{try{w.srcObject=new Blob}catch{}}w.autoplay=!0,w.controls=!0,v.appendChild(w),v.innerHTML+="<br/><span>ESCAPE - close</span>";break}default:{K(e.FileName,e.URL).then(void 0),U=!1,_(!1);break}}}window.addEventListener("keydown",e=>{if(e.key.toLocaleUpperCase()==="ESCAPE"&&U){_(!1);let t;for(;(t=v.firstChild)!==null;)v.removeChild(t);e.stopPropagation()}});function z(e=0){const t=E();setTimeout(()=>I(t).then(a=>C(a,t)),e)}async function C(e,t){f.nowFolderPath.innerText=`Path: ${t}`;const a=[],o=[];for(const i of e){const l=document.createElement("li"),y=document.createElement("span"),c=document.createElement("main");c.innerHTML='<img src="/assets/images/file.png" alt="">';let g=!1;if(i.Type=="dir"){let s=i.FileName==="z8yr3n2z8yr3n223zn7t32tz732n23tn72zt23zn7t32tz732n23tn72zt";if(c.innerHTML='<img src="/assets/images/folder.png" alt="">',y.innerText=i.FileName,s)if(t!=="/")y.innerText="\u041D\u0430\u0437\u0430\u0434";else continue;g=!0,l.onclick=r=>{if(!r.ctrlKey){pe(i.URL.substring(8));return}},s||l.addEventListener("contextmenu",r=>J(!1,i.URL,i.FileName,"",r))}else{const s=i.FileName.split(".").pop()||"";switch(s){case"png":case"gif":case"jpeg":case"svg":case"webp":case"jpg":{c.innerHTML=`<img src="${i.URL}" alt="">`;break}case"mpeg":case"ogg":case"webm":case"mp4":c.innerHTML=`<video buffered="1s" muted="muted" class="file-video"><source src="${i.URL}"/></video>`}l.addEventListener("contextmenu",r=>J(!0,i.URL,i.FileName,s,r)),l.addEventListener("click",r=>ve(H(j({},i),{Exp:s}),r)),y.innerText=i.FileName}l.appendChild(c),l.appendChild(y),(g?a:o).push(l)}let n;for(;(n=f.files.firstChild)!==null;)f.files.removeChild(n);f.files.append(...a,...o)}async function G(e){await new Promise(t=>setTimeout(t,e))}const L=[];let x=null;function we(e,t){L.push({file:e,dir:t}),X().then(void 0)}async function Le(e,t){const a=new FormData;console.log(t),a.append("file",e),a.append("dir",t);try{await p.put("/upload",a,{onUploadProgress:n=>{x=n;const i={file:e,dir:t,size:n.total,uploaded:n.loaded};for(const l of P)setTimeout(()=>l(i,L))},responseType:"text",validateStatus:()=>!0}).then(n=>{n.data.toString().startsWith("FileSystem limit(")&&(console.log("FF"),alert(`\u041C\u0435\u0441\u0442\u043E \u043D\u0430 \u0434\u0438\u0441\u043A\u0435 \u043F\u0435\u0440\u0435\u043F\u043E\u043B\u043D\u0435\u043D\u043E \u0434\u043B\u044F \u0432\u044B\u0433\u0440\u0443\u0437\u043A\u0438 ${e.name}!`))})}catch{}x=null;const o={file:e,dir:t,size:1,uploaded:1};for(const n of P)setTimeout(()=>n(o,L))}const Ee=[],P=[];function ke(e){P.push(e)}async function X(){for(const e of Ee)setTimeout(()=>e(L))}async function Y(){let e=0;for(let t=0;t<L.length;t++){const a=L[t];try{await Le(a.file,a.dir),L.splice(t,1),e++,X().then(void 0)}catch{await G(100)}}if(e>0){const t=E();await C(await I(t),t)}await G(500),Y().then(void 0)}function B(){return L}function Te(e,t={}){let a="";for(const o in t){const n=t[o];n&&o&&(a+=`${o}: ${n}`)}typeof e=="object"&&(e=JSON.stringify(e)),console.log("%c%s",a,e)}async function xe(){const{files:e,uploadInfo:t,uploadInfoFiles:a,stopUploadFiles:o}=f;e.addEventListener("dragover",n=>{f.files.style.background="#cbcbff",n.preventDefault(),n.stopPropagation()},!1),e.addEventListener("dragleave",n=>{f.files.style.background="none",n.preventDefault(),n.stopPropagation()},!1),e.addEventListener("drop",n=>{var i;f.files.style.background="none",n.preventDefault(),n.stopPropagation(),!(B().length>=1)&&(!((i=n==null?void 0:n.dataTransfer)==null?void 0:i.files)||Object.values(n.dataTransfer.files).forEach(l=>we(l,E())))},!1),o.addEventListener("click",()=>{B().splice(0,B().length),x&&(x.stopPropagation(),x.stopImmediatePropagation())}),ke((n,i)=>{const l=i.length;if(n.size<=n.uploaded||l<=0){a.innerHTML="",t.style.display="none";return}let y=0;a.innerHTML=`Left: ${l} files. <br/>`+i.map(c=>{const g=c.file===n.file?`${c.file.name}(${(n.uploaded/n.size*100).toFixed(0)}%)`:`${c.file.name}`;return y+=g.length,y%3==0?g+"<br/>":g}).join(", "),t.style.display="block"})}window.addEventListener("keyup",e=>{if(!e.ctrlKey||e.key.toLocaleLowerCase()!=="x")return;e.preventDefault();let t=prompt("Creating new file. Enter filename or cancel","");if(t===null||t.length<=0)return;const a=new FormData;a.set("file",E()+"/"+t),p.put("/acts",a).then(()=>z(1e3)).catch(void 0)});async function Ne(){const[e,t,a,o,n,i,l,y]=["#admConfig",".admDir",".admMenu",".admMenu > table",".admMenu > div > .remove__button",".admMenu > div > .new__button",".admMenu > div > .save__button",".admMenu > div > .cancel__button"].map(s=>document.querySelector(s));function c(s){a.style.display=s?"none":"block"}c(!0);const g=o.innerHTML;e.addEventListener("click",async()=>{const s=(await p.get("/acts/a_edit",{validateStatus:()=>!0,responseType:"json"})).data;let r="";for(const b in s){const m=s[b];r+=`
           <tbody data-user>
              <tr>
                 <th contenteditable data-login>${b}</th>
                 <th contenteditable data-pass>${m.Pass}</th>
                 <th contenteditable data-prefix>${m.Prefix}</th>
                 <th contenteditable data-limit>${m.Limit}</th>
                 <th contenteditable data-admin>${m.IsAdmin}</th>
                 <th contenteditable data-name>${m.Name}</th>
              </tr>
           </tbody>
            `}o.innerHTML=g+r,c(!1)}),i.addEventListener("click",()=>{o.innerHTML+=`
            <tbody data-user>
                <tr>
                    <th contenteditable data-login>New</th>
                    <th contenteditable data-pass>123123</th>
                    <th contenteditable data-prefix>/New</th>
                    <th contenteditable data-limit>128</th>
                    <th contenteditable data-admin>false</th>
                    <th contenteditable data-name>NoName</th>
                </tr>
            </tbody>
            `}),n.addEventListener("click",()=>{const s=prompt("Please enter a user's login for remove:");if(s===null||(s==null?void 0:s.length)<=0)return;const r=Object.values(o.querySelectorAll("tbody[data-user] > tr")).filter(b=>{const m=b==null?void 0:b.childNodes[1];return m instanceof HTMLElement?m.innerText==s:!1})[0].parentNode;r instanceof HTMLElement&&r.remove()}),l.addEventListener("click",()=>{const s={};for(const r of Object.values(o.querySelectorAll("tbody[data-user] > tr"))){const[b,m,te,ne,ae,ie]=["login","pass","prefix","limit","admin","name"].map(oe=>r.querySelector(`th[data-${oe}]`).innerText.toString());s[b]={Pass:m,Prefix:te,Limit:Number(ne),IsAdmin:Boolean(ae),Name:ie}}p.patch("acts/a_edit",s).then(()=>c(!0))}),y.addEventListener("click",()=>c(!0)),t.style.display="block"}const f={nowFolderPath:document.getElementById("now-folder-path"),files:document.getElementById("files"),diskQuota:document.getElementById("disk-quota"),diskQuotaText:document.getElementById("disk-quota-text"),uploadInfo:document.getElementById("uploadInfo"),uploadInfoFiles:document.getElementById("uploadInfoFiles"),stopUploadFiles:document.getElementById("stopUploadFiles")};he(async e=>{await C(await I(e),e)});let ee=!1;ye(e=>{ee||(xe().then(()=>setTimeout(()=>{console.log("%cUI successful initialized!","color: lime;")},220)),ee=!0,e.admin&&Ne().then(()=>Te("Admin initialized!",{color:"green"}))),f.diskQuota.max=e.limit;const t=Number((e.dir_size/1024/1024).toFixed(2));f.diskQuota.value=t,f.diskQuotaText.innerText=`${t}MB \u0438\u0437 ${e.limit}MB`});Y().then(void 0);
